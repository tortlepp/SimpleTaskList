<?xml version="1.0" encoding="UTF-8"?>

<!-- Basic configuration was generated by e(fx)clipse - contains now some enhacements and improvements -->
<project name="SimpleTaskList" default="do-deploy" basedir="."  xmlns:fx="javafx:com.sun.javafx.tools.ant">

    <!-- Application -->
    <property name="app.name" value="SimpleTaskList" />
    <property name="app.version" value="1.0" />
    
    
    <!-- Initialize build process -->
    <target name="init-fx-tasks">
        <path id="fxant">
            <filelist>
                <file name="${java.home}\..\lib\ant-javafx.jar" />
                <file name="${java.home}\lib\jfxrt.jar" />
            </filelist>
        </path>

        <taskdef resource="com/sun/javafx/tools/ant/antlib.xml" uri="javafx:com.sun.javafx.tools.ant" classpathref="fxant" classpath="${basedir}" />
    </target>


    <!-- Prepare the build -->
    <target name="setup-staging-area">
        <delete dir="package" />
        <delete dir="project" />

        <!-- Copy sources and additional resources -->
        <mkdir dir="project" />
        <copy todir="project">
            <fileset dir="${basedir}/../">
                <include name="src/**" />
                <include name="resources/**" />
            </fileset>
        </copy>

        <!-- Copy icons for the installer -->
        <mkdir dir="package/windows" />
        <copy todir="package/windows">
            <fileset dir="${basedir}/../contrib">
                <include name="${app.name}.ico" />
                <include name="${app.name}-setup-icon.bmp" />  
            </fileset>
        </copy>
    </target>


    <!-- Compile the Java code -->
    <target name='do-compile'>
        <delete dir="build" />

        <mkdir dir="build/src" />
        <mkdir dir="build/classes" />

        <!-- Copy all Java code -->
        <copy todir="build/src">
            <fileset dir="project/src">
                <include name="**/*" />
            </fileset>
        </copy>

        <!-- Compile the Java code -->
        <javac includeantruntime="false" source="1.8" target="1.8" srcdir="build/src" destdir="build/classes" encoding="UTF-8" />

        <!-- Copy additional files (everything except Java code) -->
        <copy todir="build/classes">
            <fileset dir="project/src">
                <exclude name="**/*.java" />
                </fileset>
        </copy>
    </target>


    <!-- Deployment -->
    <target name="do-deploy" depends="setup-staging-area, do-compile, init-fx-tasks">
        <delete file="deploy" />
        <delete file="dist" />

        <mkdir dir="dist" />

        <fx:resources id="appRes">
            <fx:fileset dir="dist" includes="${app.name}.jar" />
        </fx:resources>

        <fx:application id="fxApplication" name="${app.name}" mainClass="eu.ortlepp.tasklist.SimpleTaskList" version="${app.version}" />

        <mkdir dir="build/classes/META-INF" />

        <!-- Build a runnable JAR file -->
        <fx:jar destfile="dist/${app.name}.jar">
            <fx:application refid="fxApplication" />
            <fileset dir="build/classes" />
            <fileset dir="project/resources" />
            <fx:resources refid="appRes" />

            <manifest>
                <attribute name="Implementation-Vendor" value="Thorsten Ortlepp" />
                <attribute name="Implementation-Title" value="${app.name}" />
                <attribute name="Implementation-Version" value="${app.version}" />
                <attribute name="JavaFX-Feature-Proxy" value="None" />
            </manifest>
        </fx:jar>

        <mkdir dir="deploy" />

        <!-- Create a Windows installer -->
        <fx:deploy embedJNLP="false" extension="false" includeDT="false" offlineAllowed="true" outdir="${basedir}/deploy" outfile="${app.name}" nativeBundles="exe" updatemode="background" verbose="true">
            <fx:platform basedir="${java.home}" />
            <fx:info title="${app.name}" vendor="${app.name}" />
            <fx:application refId="fxApplication" />
            <fx:resources refid="appRes" />
        </fx:deploy>
    </target>

</project>
